!function(a){var t={};function n(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return a[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=a,n.c=t,n.d=function(e,r,a){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(r,e){if(1&e&&(r=n(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var t in r)n.d(a,t,function(e){return r[e]}.bind(null,t));return a},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=0)}([function(e,r,a){"use strict";a(1);var t,n=a(2),i=(t=n)&&t.__esModule?t:{default:t};H5P.Dialogcards=i.default},function(e,r,a){},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=i(a(3)),n=i(a(7));function i(e){return e&&e.__esModule?e:{default:e}}var l=H5P.jQuery,s=H5P.JoubelUI,o=function(e){function c(e,r,a){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,c),c.idCounter++;var d=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return d.contentId=d.id=r,d.previousState=a.previousState||{},d.contentData=a||{},d.params=l.extend({title:"",mode:"normal",description:"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.",next:"Next",prev:"Previous",retry:"Retry",answer:"Turn",correctAnswer:"I got it right!",incorrectAnswer:"I got it wrong",round:"Round @round",cardsLeft:"Cards left: @number",nextRound:"Proceed to round @round",startOver:"Start over",showSummary:"Next",summary:"Summary",summaryCardsRight:"Cards you got right:",summaryCardsWrong:"Cards you got wrong:",summaryCardsNotShown:"Cards in pool not shown:",summaryOverallScore:"Overall Score",summaryCardsCompleted:"Cards you have completed learning:",summaryCompletedRounds:"Completed rounds:",summaryAllDone:"Well done! You got all @cards cards correct @max times in a row each!",progressText:"Card @card of @total",cardFrontLabel:"Card front",cardBackLabel:"Card back",tipButtonLabel:"Show tip",audioNotSupported:"Your browser does not support this audio",confirmStartingOver:{header:"Start over?",body:"All progress will be lost. Are you sure you want to start over?",cancelLabel:"Cancel",confirmLabel:"Start over"},dialogs:[{text:"Horse",answer:"Hest"},{text:"Cow",answer:"Ku"}],behaviour:{enableRetry:!0,disableBackwardsNavigation:!1,scaleTextNotCard:!1,randomCards:!1,maxProficiency:5,quickProgression:!1}},e),d.cards=[],d.currentCardId=0,d.round=0,d.results=d.previousState.results||[],d.attach=function(e){d.$inner=e.addClass("h5p-dialogcards"),d.params.behaviour.scaleTextNotCard&&e.addClass("h5p-text-scaling");var r={mode:d.params.mode,dialogs:d.params.dialogs,audioNotSupported:d.params.audioNotSupported,answer:d.params.answer,showSummary:d.params.showSummary,incorrectAnswer:d.params.incorrectAnswer,correctAnswer:d.params.correctAnswer,progressText:d.params.progressText,tipButtonLabel:d.params.tipButtonLabel,behaviour:{scaleTextNotCard:d.params.behaviour.scaleTextNotCard,maxProficiency:d.params.behaviour.maxProficiency,quickProgression:d.params.behaviour.quickProgression},cardPiles:d.previousState.cardPiles};d.cardManager=new t.default(r,d.id,{onCardTurned:d.handleCardTurned,onNextCard:d.nextCard}),d.createDOM(0===d.round),void 0!==d.previousState.currentCardId&&(d.gotoCard(d.previousState.currentCardId),"repetition"===d.params.mode&&d.results.length===d.cardIds.length&&d.showSummary(!0)),d.updateNavigation(),d.trigger("resize")},d.createDOM=function(e){if(d.cardIds=e&&d.previousState.cardIds?d.previousState.cardIds:d.cardManager.createSelection(),d.cardPoolSize=d.cardPoolSize||d.cardManager.getSize(),!0===e){var r=l("<div>"+d.params.title+"</div>").text().trim();d.$header=l((r?'<div class="h5p-dialogcards-title"><div class="h5p-dialogcards-title-inner">'+d.params.title+"</div></div>":"")+'<div class="h5p-dialogcards-description">'+d.params.description+"</div>"),d.summaryScreen=new n.default(d.params,{nextRound:d.nextRound,retry:d.restartRepetition})}!0===e?d.$cardwrapperSet=d.initCards(d.cardIds):(d.$cardwrapperSet.remove(),d.$cardwrapperSet=d.initCards(d.cardIds),d.$cardSideAnnouncer.before(d.$cardwrapperSet)),d.$cardwrapperSet.prepend(d.summaryScreen.getDOM()),!0===e&&(d.$cardSideAnnouncer=l("<div>",{html:d.params.cardFrontLabel,class:"h5p-dialogcards-card-side-announcer","aria-live":"polite","aria-hidden":"true"}),d.$footer=d.createFooter(),d.$mainContent=l("<div>").append(d.$header).append(d.$cardwrapperSet).append(d.$cardSideAnnouncer).append(d.$footer).appendTo(d.$inner),d.on("reset",function(){this.reset()}),d.on("resize",d.resize),d.round=void 0!==d.previousState.round?d.previousState.round:1)},d.createFooter=function(){var e=l("<nav>",{class:"h5p-dialogcards-footer",role:"navigation"});return"normal"===d.params.mode?(d.$prev=s.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-prev truncated","aria-label":d.params.prev,title:d.params.prev}).click(function(){d.prevCard()}).appendTo(e),d.$next=s.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-next truncated","aria-label":d.params.next,title:d.params.next}).click(function(){d.nextCard()}).appendTo(e),d.$retry=s.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled",title:d.params.retry,html:d.params.retry}).click(function(){d.trigger("reset")}).appendTo(e),d.$progress=l("<div>",{id:"h5p-dialogcards-progress-"+c.idCounter,class:"h5p-dialogcards-progress","aria-live":"assertive"}).appendTo(e)):(d.$round=l("<div>",{class:"h5p-dialogcards-round"}).appendTo(e),d.$progress=l("<div>",{class:"h5p-dialogcards-cards-left","aria-live":"assertive"}).appendTo(e)),e},d.updateImageSize=function(){var a=0,t=d.cards[d.currentCardId].getDOM().find(".h5p-dialogcards-card-content");if(d.params.dialogs.forEach(function(e){if(e.image){var r=e.image.height/e.image.width*t.get(0).getBoundingClientRect().width;a<r&&(a=r)}}),0<a){var r=a/parseFloat(d.$inner.css("font-size"));15<r&&(r=15),d.cards.forEach(function(e){e.getImage().parent().css("height",r+"em")})}},d.initCards=function(e){d.cards=[],d.currentCardId=0,d.params.behaviour.randomCards&&(e=H5P.shuffleArray(e));for(var r=l("<div>",{class:"h5p-dialogcards-cardwrap-set"}),a=0;a<e.length&&!(2<=a);a++){var t=d.getCard(e[a]);t.setProgressText(a+1,e.length),d.cards.push(t);var n=t.getDOM();a===d.currentCardId&&(n.addClass("h5p-dialogcards-current"),d.$current=n),t.addTipToCard(n.find(".h5p-dialogcards-card-content"),"front",a),r.append(n)}return r},d.handleCardTurned=function(e){d.$cardSideAnnouncer.html(e?d.params.cardFrontLabel:d.params.cardBackLabel),d.params.behaviour.enableRetry&&d.currentCardId+1===d.cardIds.length&&d.$retry&&(d.$retry.removeClass("h5p-dialogcards-disabled"),d.truncateRetryButton())},d.updateNavigation=function(){if("normal"===d.params.mode)d.getCurrentSelectionIndex()<d.cardIds.length-1?(d.$next.removeClass("h5p-dialogcards-disabled"),d.$retry.addClass("h5p-dialogcards-disabled")):d.$next.addClass("h5p-dialogcards-disabled"),0<d.currentCardId&&!d.params.behaviour.disableBackwardsNavigation?d.$prev.removeClass("h5p-dialogcards-disabled"):d.$prev.addClass("h5p-dialogcards-disabled"),d.$progress.text(d.params.progressText.replace("@card",d.getCurrentSelectionIndex()+1).replace("@total",d.cardIds.length)),d.cards[d.findCardPosition(d.cards[d.currentCardId].id)].resizeOverflowingText();else{d.$round.text(d.params.round.replace("@round",d.round));var e=d.getCurrentSelectionIndex();d.$progress.text(d.params.cardsLeft.replace("@number",d.cardIds.length-e))}d.trigger("resize")},d.showSummary=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0]?d.cardManager.getPileSizes():d.cardManager.updatePiles(d.results),r=d.results.filter(function(e){return!0===e.result}).length,a=d.results.length-r,t=d.cardPoolSize-r-a,n=e.slice(-1)[0],i=n===d.cardPoolSize,s={round:d.round,results:[{field:"h5p-dialogcards-round-cards-right",score:{value:r,max:a+r}},{field:"h5p-dialogcards-round-cards-wrong",score:{value:a,max:a+r}},{field:"h5p-dialogcards-round-cards-not-shown",score:{value:t}},{field:"h5p-dialogcards-overall-cards-completed",score:{value:n,max:d.cardPoolSize}},{field:"h5p-dialogcards-overall-completed-rounds",score:{value:d.round}}]};i&&(s.done=!0,s.message=d.params.summaryAllDone.replace("@cards",d.cardPoolSize).replace("@max",d.params.behaviour.maxProficiency-1)),d.summaryScreen.update(s),d.summaryScreen.show(),d.hideCards(),d.trigger("resize")},d.showCards=function(){d.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").removeClass("h5p-dialogcards-gone"),d.$footer.removeClass("h5p-dialogcards-gone"),d.cardsShown=!0},d.hideCards=function(){d.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").addClass("h5p-dialogcards-gone"),d.$footer.addClass("h5p-dialogcards-gone"),d.cardsShown=!1},d.nextCard=function(e){void 0!==e&&d.results.push(e),d.cardIds.length-d.getCurrentSelectionIndex()!=1?d.gotoCard(d.getCurrentSelectionIndex()+1):"repetition"===d.params.mode&&(d.$progress.text(d.params.cardsLeft.replace("@number",0)),d.cards[d.currentCardId].showSummaryButton(d.showSummary))},d.getCard=function(e){var r=d.cardManager.getCard(e);return r.createButtonListeners(),r},d.findCardPosition=function(a){var t=void 0;return d.cards.forEach(function(e,r){t||e.id!==a||(t=r)}),t},d.insertCardToDOM=function(e,r){var a=e.getDOM();void 0===r?a.appendTo(d.$cardwrapperSet):0===r?d.$cardwrapperSet.prepend(a):d.$cardwrapperSet.children().eq(r).after(a),e.addTipToCard(a.find(".h5p-dialogcards-card-content"),"front",r)},d.gotoCard=function(a){if(!(a<0||a>=d.cardIds.length)){var e=d.cards[d.currentCardId];e.stopAudio(),e.getDOM().removeClass("h5p-dialogcards-current");var r=[];0<a&&r.push(a-1),r.push(a),a+1<d.cardIds.length&&r.push(a+1),r.forEach(function(e){if(void 0===d.findCardPosition(d.cardIds[e])){var r=d.getCard(d.cardIds[e]);r.setProgressText(e+1,d.cardIds.length);var a=Math.min(e+1,d.cardIds.length-1),t=d.findCardPosition(d.cardIds[a])||d.cards.length;d.cards.splice(t,0,r),d.insertCardToDOM(r,t)}}),d.resize(),a=d.findCardPosition(d.cardIds[a]),d.cards.forEach(function(e,r){r<a?e.getDOM().addClass("h5p-dialogcards-previous"):(e.getDOM().removeClass("h5p-dialogcards-previous"),r===a&&e.getDOM().addClass("h5p-dialogcards-current"))}),d.currentCardId=a,d.updateNavigation(),d.cards[d.currentCardId].setCardFocus()}},d.prevCard=function(){d.gotoCard(d.getCurrentSelectionIndex()-1)},d.showAllAudio=function(){d.$cardwrapperSet.find(".h5p-audio-inner").removeClass("hide")},d.restartRepetition=function(){d.cardManager.reset(),d.round=0,d.nextRound()},d.nextRound=function(){d.round++,d.summaryScreen.hide(),d.showCards(),d.reset(),d.createDOM(),d.updateNavigation(),d.cards[d.currentCardId].setCardFocus(!0),d.trigger("resize")},d.reset=function(){d.results=[],d.cards[d.currentCardId].stopAudio(d.$current.index()),d.cards.forEach(function(e){e.reset()}),d.currentCardId=0,"normal"===d.params.mode&&d.cards[d.currentCardId].getDOM().addClass("h5p-dialogcards-current"),d.updateNavigation(),d.$retry&&d.$retry.addClass("h5p-dialogcards-disabled"),d.showAllAudio(),d.cards[d.currentCardId].resizeOverflowingText(),d.cards[d.currentCardId].setCardFocus()},d.resize=function(){var a=0;d.updateImageSize(),d.params.behaviour.scaleTextNotCard||!1===d.cardsShown||d.determineCardSizes(),d.$cardwrapperSet.css("height","auto"),d.$cardwrapperSet.children(":not(.h5p-dialogcards-gone)").each(function(){var e=l(this).css("height","initial").outerHeight();if(l(this).css("height","inherit"),a=a<e?e:a,!l(this).next(".h5p-dialogcards-cardwrap").length){var r=l(this).find(".h5p-dialogcards-cardholder").css("height","initial").outerHeight();a=a<r?r:a,l(this).find(".h5p-dialogcards-cardholder").css("height","inherit")}});var e=a/parseFloat(d.$cardwrapperSet.css("font-size"));d.$cardwrapperSet.css("height",e+"em"),d.scaleToFitHeight(),d.truncateRetryButton(),d.cards[d.currentCardId].resizeOverflowingText()},d.determineCardSizes=function(){var c=d;void 0===d.cardSizeDetermined&&(d.cardSizeDetermined=[]),d.$cardwrapperSet.children(":visible").each(function(e){var r=c.cards[e].id;if(-1===c.cardSizeDetermined.indexOf(r)){c.cardSizeDetermined.push(r);var a=l(".h5p-dialogcards-card-content",this),t=l(".h5p-dialogcards-card-text-inner-content",a),n=t[0].getBoundingClientRect().height,i=c.cards[e];i.changeText(i.getAnswer());var s=t[0].getBoundingClientRect().height,o=s<n?n:s,d=parseFloat(t.parent().parent().css("minHeight"));o<d&&(o=d),o/=parseFloat(a.css("fontSize")),t.parent().css("height",o+"em"),i.changeText(i.getText())}})},d.scaleToFitHeight=function(){if(d.$cardwrapperSet&&d.$cardwrapperSet.is(":visible")&&d.params.behaviour.scaleTextNotCard)if(d.$inner.parents(".h5p-course-presentation").length){var e=d.$inner.parent();d.$inner.parents(".h5p-popup-container").length&&(e=d.$inner.parents(".h5p-popup-container"));var r=e.get(0).getBoundingClientRect().height,a=function(){var r=0;return d.$inner.children().each(function(){var e=l(this);r+=this.getBoundingClientRect().height+parseFloat(e.css("margin-top"))+parseFloat(e.css("margin-bottom"))}),r},t=a(),n=parseFloat(d.$inner.parent().css("font-size")),i=parseFloat(d.$inner.css("font-size"));if(r<t)for(;r<t&&!((i-=c.SCALEINTERVAL)<c.MINSCALE);)d.$inner.css("font-size",i/n+"em"),t=a();else for(var s=!0;s;){if(c.MAXSCALE<(i+=c.SCALEINTERVAL)){s=!1;break}var o=i/n;d.$inner.css("font-size",o+"em"),r<=(t=a())&&(s=!1,o=(i-c.SCALEINTERVAL)/n,d.$inner.css("font-size",o+"em"))}}else d.cards[d.currentCardId].resizeOverflowingText()},d.truncateRetryButton=function(){if(d.$retry){d.$retry.removeClass("truncated"),d.$retry.html(d.params.retry);.3<(d.$retry.get(0).getBoundingClientRect().width+parseFloat(d.$retry.css("margin-left"))+parseFloat(d.$retry.css("margin-right")))/d.$retry.parent().get(0).getBoundingClientRect().width&&(d.$retry.addClass("truncated"),d.$retry.html(""))}},d.getCurrentSelectionIndex=function(){return d.cardIds.indexOf(d.cards[d.currentCardId].id)},d.getTitle=function(){return H5P.createTitle(d.contentData&&d.contentData.metadata&&d.contentData.metadata.title?d.contentData.metadata.title:"Dialog Cards")},d.getCurrentState=function(){return{cardPiles:d.cardManager.getPiles(),cardIds:d.cardIds,round:d.round,currentCardId:d.getCurrentSelectionIndex(),results:d.results}},d}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(c,H5P.EventDispatcher),c}();o.idCounter=0,o.SCALEINTERVAL=.2,o.MAXSCALE=16,o.MINSCALE=4,r.default=o},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=t(a(4)),s=t(a(6));function t(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var r=0,a=Array(e.length);r<e.length;r++)a[r]=e[r];return a}return Array.from(e)}var d=function(){function t(e,r,a){return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,this.cardPool=new i.default(e,r,a),this.reset(e.cardPiles),this}return n(t,[{key:"createSelection",value:function(){var e=[];switch(this.params.mode){case"repetition":e=this.createSelectionRepetition();break;default:e=this.cardPool.getCardIds()}return e}},{key:"createPiles",value:function(e){if(e)this.cardPiles=e.map(function(e){return new s.default(e.cards)});else{this.cardPiles=[];var r=this.cardPool.getCardIds();switch(this.params.mode){case"repetition":for(var a=0;a<this.params.behaviour.maxProficiency;a++)0===a?this.cardPiles.push(new s.default(r)):this.cardPiles.push(new s.default);break;case"normal":this.cardPiles.push(new s.default(r))}}}},{key:"updatePiles",value:function(e){var t=this;return e.forEach(function(e){var r=t.find(e.cardId);if(-1!==r){var a=!0===e.result?r+1:0;a=Math.max(0,Math.min(a,t.cardPiles.length-1)),t.cardPiles[r].remove(e.cardId),t.cardPiles[a].add(e.cardId,"bottom")}}),this.getPileSizes()}},{key:"createSelectionRepetition",value:function(){for(var e=[],r=null,a=0;a<this.cardPiles.length-1;a++){var t,n=this.cardPiles[a].length();if(null!==r||0!==n){null===r&&(r=a);var i=Math.ceil(1*n/(1+a-r)),s=this.cardPiles[a].peek(0,i);e=(t=e).concat.apply(t,o(s))}}return e=this.shuffle(e)}},{key:"shuffle",value:function(e){for(var r=e.slice(),a=r.length-1;0<a;a--){var t=Math.floor(Math.random()*(a+1)),n=[r[t],r[a]];r[a]=n[0],r[t]=n[1]}return r}},{key:"find",value:function(a){var t=-1;return this.cardPiles.forEach(function(e,r){if(-1!==t)return t;e.contains(a)&&(t=r)}),t}},{key:"reset",value:function(e){this.createPiles(e)}},{key:"getCard",value:function(e){return this.cardPool.getCard(e)}},{key:"getSize",value:function(){return this.cardPool.getCardIds().length}},{key:"getPiles",value:function(){return this.cardPiles}},{key:"getPileSizes",value:function(){return this.cardPiles.map(function(e){return e.length()})}}]),t}();r.default=d},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t,i=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),n=a(5),s=(t=n)&&t.__esModule?t:{default:t};var o=function(){function n(e,r,a){var t=this;return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,n),this.params=e,this.contentId=r,this.callbacks=a,this.cards=[],this.params.dialogs.forEach(function(e,r){e.id=r,t.cards.push(r)}),this}return i(n,[{key:"getCard",value:function(e){if(!(e<0||e>this.cards.length))return"number"==typeof this.cards[e]&&this.loadCard(e),this.cards[e]}},{key:"getCardIds",value:function(){return this.cards.map(function(e,r){return r})}},{key:"loadCard",value:function(e){e<0||e>this.cards.length||"number"==typeof this.cards[e]&&(this.cards[e]=new s.default(this.params.dialogs[e],this.params,e,this.contentId,this.callbacks))}}]),n}();r.default=o},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();var s=H5P.jQuery,n=function(){function l(e,r,a,t){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,l),this.card=e,this.params=r||{},this.id=a,this.contentId=t,this.callbacks=n,this.$cardWrapper=s("<div>",{class:"h5p-dialogcards-cardwrap",role:"group",tabindex:"-1"}),"repetition"!==this.params.mode&&this.$cardWrapper.attr("aria-labelledby","h5p-dialogcards-progress-"+H5P.Dialogcards.idCounter),this.$cardHolder=s("<div>",{class:"h5p-dialogcards-cardholder"}).appendTo(this.$cardWrapper),this.createCardContent(e).appendTo(this.$cardHolder),this}return t(l,[{key:"createCardContent",value:function(e){var r=s("<div>",{class:"h5p-dialogcards-card-content"});this.createCardImage(e).appendTo(r);var a=s("<div>",{class:"h5p-dialogcards-card-text-wrapper"}).appendTo(r),t=s("<div>",{class:"h5p-dialogcards-card-text-inner"}).appendTo(a),n=s("<div>",{class:"h5p-dialogcards-card-text-inner-content"}).appendTo(t);this.createCardAudio(e).appendTo(n);var i=s("<div>",{class:"h5p-dialogcards-card-text"}).appendTo(n);return this.$cardTextArea=s("<div>",{class:"h5p-dialogcards-card-text-area",tabindex:"-1",html:e.text}).appendTo(i),e.text&&e.text.length||i.addClass("hide"),this.createCardFooter().appendTo(a),r}},{key:"createCardImage",value:function(e){this.$image;var r=s("<div>",{class:"h5p-dialogcards-image-wrapper"});return void 0!==e.image?(this.image=e.image,this.$image=s('<img class="h5p-dialogcards-image" src="'+H5P.getPath(e.image.path,this.contentId)+'"/>'),e.imageAltText&&this.$image.attr("alt",e.imageAltText)):this.$image=s('<div class="h5p-dialogcards-image"></div>'),this.$image.appendTo(r),r}},{key:"createCardAudio",value:function(e){if(this.audio,this.$audioWrapper=s("<div>",{class:"h5p-dialogcards-audio-wrapper"}),void 0!==e.audio){var r={files:e.audio,audioNotSupported:this.params.audioNotSupported};this.audio=new H5P.Audio(r,this.contentId),this.audio.attach(this.$audioWrapper),this.audio.audio&&this.audio.audio.preload&&(this.audio.audio.preload="none")}else this.$audioWrapper.addClass("hide");return this.$audioWrapper}},{key:"createCardFooter",value:function(){var e=s("<div>",{class:"h5p-dialogcards-card-footer"}),r="h5p-dialogcards-button-hidden",a="-1";return"repetition"===this.params.mode&&(r="",this.params.behaviour.quickProgression&&(r="h5p-dialogcards-quick-progression",a="0")),this.$buttonTurn=H5P.JoubelUI.createButton({class:"h5p-dialogcards-turn",html:this.params.answer}).appendTo(e),this.$buttonShowSummary=H5P.JoubelUI.createButton({class:"h5p-dialogcards-show-summary h5p-dialogcards-button-gone",html:this.params.showSummary}).appendTo(e),this.$buttonIncorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.incorrectAnswer}).addClass("incorrect").addClass(r).attr("tabindex",a).appendTo(e),this.$buttonCorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.correctAnswer}).addClass("correct").addClass(r).attr("tabindex",a).appendTo(e),e}},{key:"createButtonListeners",value:function(){var r=this;this.$buttonIncorrect.unbind("click").click(function(e){e.target.classList.contains("h5p-dialogcards-quick-progression")&&r.callbacks.onNextCard({cardId:r.id,result:!1})}),this.$buttonTurn.unbind("click").click(function(){r.turnCard()}),this.$buttonCorrect.unbind("click").click(function(e){e.target.classList.contains("h5p-dialogcards-quick-progression")&&r.callbacks.onNextCard({cardId:r.id,result:!0})})}},{key:"showSummaryButton",value:function(e){this.getDOM().find(".h5p-dialogcards-answer-button").addClass("h5p-dialogcards-button-hidden").attr("tabindex","-1"),this.$buttonTurn.addClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.click(function(){return e()}).removeClass("h5p-dialogcards-button-gone").focus()}},{key:"hideSummaryButton",value:function(){"normal"!==this.params.mode&&(this.getDOM().find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-button-hidden").attr("tabindex","0"),this.$buttonTurn.removeClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.addClass("h5p-dialogcards-button-gone"))}},{key:"turnCard",value:function(){var r=this,a=this.getDOM(),t=a.find(".h5p-dialogcards-card-content"),n=a.find(".h5p-dialogcards-cardholder").addClass("h5p-dialogcards-collapse");t.find(".joubel-tip-container").remove();var i=t.hasClass("h5p-dialogcards-turned");t.toggleClass("h5p-dialogcards-turned",!i),setTimeout(function(){if(n.removeClass("h5p-dialogcards-collapse"),r.changeText(i?r.getText():r.getAnswer()),i?n.find(".h5p-audio-inner").removeClass("hide"):r.removeAudio(n),"repetition"===r.params.mode&&!r.params.behaviour.quickProgression){var e=a.find(".h5p-dialogcards-answer-button");!1===e.hasClass("h5p-dialogcards-quick-progression")&&e.addClass("h5p-dialogcards-quick-progression").attr("tabindex",0)}setTimeout(function(){r.addTipToCard(t,i?"front":"back"),"function"==typeof r.callbacks.onCardTurned&&r.callbacks.onCardTurned(i)},200),r.resizeOverflowingText(),r.$cardTextArea.focus()},200)}},{key:"changeText",value:function(e){this.$cardTextArea.html(e),this.$cardTextArea.toggleClass("hide",!e||!e.length)}},{key:"setProgressText",value:function(e,r){if("repetition"===this.params.mode){var a=this.params.progressText.replace("@card",e.toString()).replace("@total",r.toString());this.$cardWrapper.attr("aria-label",a)}}},{key:"resizeOverflowingText",value:function(){if(this.params.behaviour.scaleTextNotCard){var e=this.getDOM().find(".h5p-dialogcards-card-text"),r=e.children();this.resizeTextToFitContainer(e,r)}}},{key:"resizeTextToFitContainer",value:function(e,r){r.css("font-size","");var a=e.get(0).getBoundingClientRect().height,t=r.get(0).getBoundingClientRect().height,n=parseFloat(e.css("font-size")),i=parseFloat(r.css("font-size")),s=this.getDOM().closest(".h5p-container"),o=parseFloat(s.css("font-size"));if(a<t)for(var d=!0;d;){if((i-=l.SCALEINTERVAL)<l.MINSCALE){d=!1;break}r.css("font-size",i/n+"em"),(t=r.get(0).getBoundingClientRect().height)<=a&&(d=!1)}else for(var c=!0;c;){if(o<(i+=l.SCALEINTERVAL)){c=!1;break}r.css("font-size",i/n+"em"),a<=(t=r.get(0).getBoundingClientRect().height)&&(c=!1,i-=l.SCALEINTERVAL,r.css("font-size",i/n+"em"))}}},{key:"addTipToCard",value:function(e,r,a){"back"!==r&&(r="front"),void 0===a&&(a=this.id),e.find(".joubel-tip-container").remove();var t=this.card.tips;if(void 0!==t&&void 0!==t[r]){var n=t[r].trim();n.length&&e.find(".h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner").after(H5P.JoubelUI.createTip(n,{tipLabel:this.params.tipButtonLabel}))}}},{key:"setCardFocus",value:function(e){if(!0===e)this.$cardTextArea.focus();else{var r=this.getDOM();r.one("transitionend",function(){r.focus()})}}},{key:"stopAudio",value:function(){this.audio&&this.audio.stop&&this.audio.stop()}},{key:"removeAudio",value:function(){this.stopAudio(),this.getDOM().find(".h5p-audio-inner").addClass("hide")}},{key:"getDOM",value:function(){return this.$cardWrapper}},{key:"getText",value:function(){return this.card.text}},{key:"getAnswer",value:function(){return this.card.answer}},{key:"getImage",value:function(){return this.$image}},{key:"getImageSize",value:function(){return this.image?{width:this.image.width,height:this.image.height}:this.image}},{key:"getAudio",value:function(){return this.$audioWrapper}},{key:"reset",value:function(){var e=this.getDOM();e.removeClass("h5p-dialogcards-previous"),e.removeClass("h5p-dialogcards-current"),this.changeText(this.getText());var r=e.find(".h5p-dialogcards-card-content");r.removeClass("h5p-dialogcards-turned"),this.addTipToCard(r,"front",this.id),this.params.behaviour.quickProgression||e.find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-quick-progression"),this.hideSummaryButton()}}]),l}();n.SCALEINTERVAL=.2,n.MAXSCALE=16,n.MINSCALE=4,r.default=n},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();var n=function(){function e(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.cards=a.filter(function(e,r){return a.indexOf(e)>=r}),this}return t(e,[{key:"getCards",value:function(){return this.cards}},{key:"peek",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return r=Math.max(0,r),"top"===e&&(e=0),"bottom"===e&&(e=this.cards.length-r),e<0||e>this.cards.length-1?[]:this.cards.slice(e,e+r)}},{key:"add",value:function(a){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top";"number"==typeof a&&(a=[a]),a.forEach(function(e){var r;-1===t.cards.indexOf(e)&&("top"===n?n=0:"bottom"===n?n=t.cards.length:"random"===n&&(n=Math.floor(Math.random()*t.cards.length)),(r=t.cards).splice.apply(r,[n,0].concat(function(e){if(Array.isArray(e)){for(var r=0,a=Array(e.length);r<e.length;r++)a[r]=e[r];return a}return Array.from(e)}(a))))})}},{key:"push",value:function(e){this.add(e,"top")}},{key:"pull",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top";return e=Math.max(1,Math.min(e,this.cards.length)),"top"===r&&(r=0),"bottom"===r&&(r=-e),r=Math.max(0,Math.min(r,this.cards.length-1)),this.cards.splice(r,e)}},{key:"remove",value:function(e){var a=this;"number"==typeof e&&(e=[e]),e.forEach(function(e){var r=a.cards.indexOf(e);-1<r&&a.cards.splice(r,1)})}},{key:"shuffle",value:function(){for(var e=this.cards.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1)),a=[this.cards[r],this.cards[e]];this.cards[e]=a[0],this.cards[r]=a[1]}return this.cards}},{key:"contains",value:function(e){return-1!==this.cards.indexOf(e)}},{key:"length",value:function(){return this.cards.length}}]),e}();r.default=n},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();var n=function(){function l(e,r){var a=this;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,l),this.params=e,this.callbacks=r,this.currentCallback=r.nextRound,this.fields=[],this.container=document.createElement("div"),this.container.classList.add("h5p-dialogcards-summary-screen");var t=this.createContainerDOM(e.summary);this.fields.round=t.getElementsByClassName("h5p-dialogcards-summary-subheader")[0],this.fields["h5p-dialogcards-round-cards-right"]=this.addTableRow(t,{category:this.params.summaryCardsRight,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-round-cards-wrong"]=this.addTableRow(t,{category:this.params.summaryCardsWrong,symbol:"h5p-dialogcards-times"}),this.fields["h5p-dialogcards-round-cards-not-shown"]=this.addTableRow(t,{category:this.params.summaryCardsNotShown});var n=this.createContainerDOM(e.summaryOverallScore);this.fields["h5p-dialogcards-overall-cards-completed"]=this.addTableRow(n,{category:this.params.summaryCardsCompleted,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-overall-completed-rounds"]=this.addTableRow(n,{category:this.params.summaryCompletedRounds,symbol:""});var i=document.createElement("div");i.classList.add("h5p-dialogcards-summary-message"),this.fields.message=i;var s=H5P.JoubelUI.createButton({class:"h5p-dialogcards-buttonNextRound",title:this.params.nextRound.replace("@round",2),html:this.params.nextRound.replace("@round",2)}).click(this.currentCallback).get(0);this.fields.button=s;var o=H5P.JoubelUI.createButton({class:"h5p-dialogcards-button-restart",title:this.params.startOver,html:this.params.startOver}).get(0),d=this.createConfirmationDialog({l10n:this.params.confirmStartingOver,instance:this},function(){setTimeout(function(){a.callbacks.retry()},100)});o.addEventListener("click",function(e){d.show(e.target.offsetTop)}),this.fields.buttonStartOver=o;var c=document.createElement("div");return c.classList.add("h5p-dialogcards-summary-footer"),c.appendChild(o),c.appendChild(s),this.container.appendChild(t),this.container.appendChild(n),this.container.appendChild(i),this.container.appendChild(c),this.hide(),this}return t(l,[{key:"getDOM",value:function(){return this.container}},{key:"createContainerDOM",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=document.createElement("div");a.classList.add("h5p-dialogcards-summary-container");var t=document.createElement("div");t.classList.add("h5p-dialogcards-summary-header"),t.innerHTML=e,a.appendChild(t);var n=document.createElement("div");n.classList.add("h5p-dialogcards-summary-subheader"),n.innerHTML=r,a.appendChild(n);var i=document.createElement("table");return i.classList.add("h5p-dialogcards-summary-table"),a.appendChild(i),a}},{key:"addTableRow",value:function(e,r){var a=e.getElementsByClassName("h5p-dialogcards-summary-table")[0],t=document.createElement("tr"),n=document.createElement("td");n.classList.add("h5p-dialogcards-summary-table-row-category"),n.innerHTML=r.category,t.appendChild(n);var i=document.createElement("td");i.classList.add("h5p-dialogcards-summary-table-row-symbol"),void 0!==r.symbol&&""!==r.symbol&&i.classList.add(r.symbol),t.appendChild(i);var s=document.createElement("td");return s.classList.add("h5p-dialogcards-summary-table-row-score"),t.appendChild(s),a.appendChild(t),s}},{key:"update",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.done,t=void 0!==r&&r,n=e.round,i=void 0===n?void 0:n,s=e.message,o=void 0===s?void 0:s,d=e.results,c=void 0===d?[]:d;!0===t?(this.fields.buttonStartOver.classList.add("h5p-dialogcards-button-gone"),this.params.behaviour.enableRetry?(this.fields.button.classList.remove("h5p-dialogcards-button-next-round"),this.fields.button.classList.add("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.retry,this.fields.button.title=this.params.retry,this.currentCallback=this.callbacks.retry):this.fields.button.classList.add("h5p-dialogcards-button-gone")):(this.fields.buttonStartOver.classList.remove("h5p-dialogcards-button-gone"),this.fields.button.classList.add("h5p-dialogcards-button-next-round"),this.fields.button.classList.remove("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.nextRound,this.fields.button.title=this.params.nextRound,this.currentCallback=this.callbacks.nextRound),H5P.jQuery(this.fields.button).unbind("click").click(this.currentCallback),this.fields.round.innerHTML=this.params.round.replace("@round",i),t||void 0===i||(this.fields.button.innerHTML=this.params.nextRound.replace("@round",i+1),this.fields.button.title=this.params.nextRound.replace("@round",i+1)),t&&void 0!==o&&""!==o?(this.fields.message.classList.remove("h5p-dialogcards-gone"),this.fields.message.innerHTML=o):this.fields.message.classList.add("h5p-dialogcards-gone"),c.forEach(function(e){var r=void 0!==e.score.value?e.score.value:"";void 0!==e.score.max&&(r=r+'&nbsp;<span class="h5p-dialogcards-summary-table-row-score-divider">/</span>&nbsp;'+e.score.max),a.fields[e.field].innerHTML=r})}},{key:"show",value:function(){this.container.classList.remove("h5p-dialogcards-gone"),this.fields.button.focus()}},{key:"hide",value:function(){this.container.classList.add("h5p-dialogcards-gone")}},{key:"createConfirmationDialog",value:function(e,r){e=e||{};var a=new H5P.ConfirmationDialog({instance:e.instance,headerText:e.l10n.header,dialogText:e.l10n.body,cancelText:e.l10n.cancelLabel,confirmText:e.l10n.confirmLabel});return a.on("confirmed",function(){r()}),a.appendTo(this.getContainer()),a}},{key:"getContainer",value:function(){var e=H5P.jQuery('[data-content-id="'+self.contentId+'"].h5p-content'),r=e.parents(".h5p-container");return(0!==r.length?r.last():0!==e.length?e:H5P.jQuery(document.body)).get(0)}}]),l}();r.default=n}]);